const User = require('./services/models/userModel');
const Post = require('./services/models/postModel');
const bodyParser = require('body-parser');
const express = require("express");
const { generateUsersAndPosts } = require("./services/db/faker");

const app = express();
app.use(bodyParser.json());

(async () => {
    // Valeur à changer pour générer des utilisateurs et des posts
    await generateUsersAndPosts(0);
})();

// API POUR USER

app.get("/users", async (req, res) => {
    let users = await User.getAll();
    res.send(users);
});

app.post("/postUser", async (req, res) => {
    try {
        let user = await User.createUser(req.body);
        res.send(user);
    } catch (error) {
        res.status(500).json({ message: error.message });
    }
});

app.get("/user/:id", async (req, res) => {
    let user = await User.getUserById(req.params.id);
    res.send(user);
});

app.put("/user/:id", async (req, res) => {
    try {
        let user = await User.updateUserById(req.params.id, req.body.username, req.body.first_name, req.body.last_name, req.body.email);
        res.send(user);
    } catch (error) {
        res.status(500).json({ message: error.message });
    }
});

app.delete("/user/:id", async (req, res) => {
    try {
        let user = await User.deleteUserById(req.params.id);
        res.send("User has been deleted successfully");
    } catch (error) {
        res.status(500).json({ message: error.message });
    }
});

// API POUR POST

app.get("/posts", async (req, res) => {
    let posts = await Post.getAll();
    res.send(posts);
});

app.post("/postPost", async (req, res) => {
    try {
        let post = await Post.createPost(req.body);
        res.send(post);
    } catch (error) {
        res.status(500).json({ message: error.message });
    }
});

app.get("/post/:id", async (req, res) => {
    let post = await Post.getPostById(req.params.id);
    res.send(post);
});

app.put("/post/:id", async (req, res) => {
    try {
        let post = await Post.updatePostById(req.params.id, req.body.content, req.body.user_id);
        res.send(post);
    } catch (error) {
        res.status(500).json({ message: error.message });
    }
});

app.delete("/post/:id", async (req, res) => {
    try {
        let post = await Post.deletePostById(req.params.id);
        res.send("Post has been deleted successfully");
    } catch (error) {
        res.status(500).json({ message: error.message });
    }
});

// Lancement du serveur
app.listen(3000, () => {
    console.log("Server running on port http://localhost:3000");
}
);
