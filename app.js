const User = require('./services/models/userModel');
const Post = require('./services/models/postModel');
const bodyParser = require('body-parser');
const express = require("express");
const { generateUsers, generatePosts } = require("./services/db/faker");

const app = express();
app.use(bodyParser.json());

const generatedUsers = generateUsers(0);
generatedUsers.forEach(async (user) => {
    let fakeUser = await User.createUser(user);
    console.log(fakeUser);
});

const generatedPosts = generatePosts(0);
generatedPosts.forEach(async (post) => {
    let fakePost = await Post.createPost(post);
    console.log(fakePost);
});

// API POUR USER

app.get("/users", async (req, res) => {
    let users = await User.getAll();
    res.send(users);
});

app.post("/postUser", async (req, res) => {
    try {
        let user = await User.createUser(req.body);
        res.send(user);
    } catch (error) {
        res.status(500).json({ message: error.message });
    }
});

app.get("/user/:id", async (req, res) => {
    let user = await User.getUserById(req.params.id);
    res.send(user);
});

app.put("/user/:id", async (req, res) => {
    try {
        let user = await User.updateUserById(req.params.id, req.body.username, req.body.first_name, req.body.last_name, req.body.email);
        res.send(user);
    } catch (error) {
        res.status(500).json({ message: error.message });
    }
});

app.delete("/user/:id", async (req, res) => {
    try {
        let user = await User.deleteUserById(req.params.id);
        res.send("User has been deleted successfully");
    } catch (error) {
        res.status(500).json({ message: error.message });
    }
});

// API POUR POST

app.get("/posts", async (req, res) => {
    let posts = await Post.getAll();
    res.send(posts);
});

app.post("/postPost", async (req, res) => {
    try {
        let post = await User.createPost(req.body);
        res.send(post);
    } catch (error) {
        res.status(500).json({ message: error.message });
    }
});

app.get("/post/:id", async (req, res) => {
    let post = await Post.getPostById(req.params.id);
    res.send(post);
});

// Lancement du serveur
app.listen(3000, () => {
    console.log("Server running on port http://localhost:3000");
}
);
