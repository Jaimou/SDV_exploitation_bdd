const Model = require('../db/db.js');

class Reaction extends Model {
    static get tableName() {
        return 'reactions';
    }

    static get idColumn() {
        return ['user_id', 'post_id'];
    }

    static get jsonSchema() {
        return {
            type: 'object',
            required: ['user_id', 'post_id', 'type'],

            properties: {
                user_id: { type: 'integer' },
                post_id: { type: 'integer' },
                type: { type: 'string', enum: ['LIKE', 'DISLIKE'] }
            },
            additionalProperties: false,

        };
    }

    static async getAll() {
        return await this.query();
    }

    static async getReactionByUserId(user_id) {
        return await this.query().where({ user_id });
    }

    static async getReactionByPostId(post_id) {
        return await this.query().where({ post_id });
    }

    static async createReaction(reaction) {
        return await this.query().insert(reaction);
    }

    static async updateReactionById(user_id, post_id, type) {
        return await this.query().patch(type).where('user_id', user_id).andWhere('post_id', post_id);
    }

    static async deleteReactionById(user_id, post_id) {
        return await this.query().where('user_id', user_id).where('post_id', post_id).delete();
    }

}

module.exports = Reaction;