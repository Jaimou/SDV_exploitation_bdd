const Model = require('../db/db.js');

class Report extends Model {
    static get tableName() {
        return 'reports';
    }

    static get idColumn() {
        return ['user_id', 'post_id'];
    }

    static get jsonSchema() {
        return {
            type: 'object',
            required: ['user_id', 'post_id', 'reason'],

            properties: {
                user_id: { type: 'integer' },
                post_id: { type: 'integer' },
                reason: { type: 'string', minLength: 1, maxLength: 50 }
            },
            additionalProperties: false,

        };
    }

    static async getAll() {
        return await this.query();
    }

    static async getReportById(user_id, post_id) {
        return await this.query().where({ user_id, post_id });
    }

    static async getReportByUserId(user_id) {
        return await this.query().where({ user_id });
    }

    static async getReportByPostId(post_id) {
        return await this.query().where({ post_id });
    }

    static async createReport(report) {
        return await this.query().insert(report);
    }

    static async updateReportById(user_id, post_id, reason) {
        return await this.query().patch(reason).where('user_id', user_id).andWhere('post_id', post_id);
    }

    static async deleteReportById(user_id, post_id) {
        return await this.query().where('user_id', user_id).where('post_id', post_id).delete();
    }

}

module.exports = Report;